<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>지도뿌셔 - 대한민국, 어디까지 가봤니?</title>
    <link rel="stylesheet" href="src/css/index.css" />
</head>
<body>
<div class="header-container">
    <img src="src/images/back.png" class="back" onclick="goMenu('mapNames.html')"/>
    <span onclick="goMenu('mapNames.html')">지도뿌셔</span>
    <img src="src/images/menu_icon.png" class="menu" onclick="goMenu('menu.html')"/>
</div>
<div class="map-timeLine-container" id="timeLine">
    <span class="page-title" id="pageTitle"></span>
</div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="src/js/index.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', async function() {

        const db = await openIndexedDB('MapColorDB', 1);
        const allDatas = await getAllData(db, 'mapNames');

        const timeLineContainer = document.getElementById("timeLine");
        const sigunguData = await fetchJSON();
        const mapName = localStorage.getItem("mapName");

        const filteredItems = allDatas.filter(item => item.mapName === mapName);
        const uniqueSigunguSet = filteredItems.reduce((acc, current) => {

            if(current.data === undefined) current['data'] = [];

            current.data.forEach(item => {
                const key = item.sigunguCd;
                if (key && !acc.has(key)) {
                    acc.add(key);
                }
            });
            return acc;
        }, new Set());

        const pointCnt = uniqueSigunguSet.size;

        document.getElementById('pageTitle').innerHTML = '<span class="map-name">' + mapName + '</span> <span class="map-cnt">' + pointCnt + '/' + sigunguData.features.length + '</span>';

        if(pointCnt === 0) {

            const noData = document.createElement('div');
            noData.className = 'no-data';

            const div = document.createElement('div');
            div.className = 'no-sub-data'

            const img = document.createElement('img');
            img.className = 'no-data-img'
            img.src = 'src/images/no-data.png';
            div.appendChild(img);

            const noContents = document.createElement('div');
            noContents.className = 'no-contents'
            noContents.innerHTML = '데이터가 텅 비어있어요';
            div.appendChild(noContents);

            const plusAreaDiv = document.createElement("div");
            plusAreaDiv.className = 'plus-area-div';

            const plusDiv = document.createElement("div");
            plusDiv.className = 'plus-img-div';

            const plusImg = document.createElement("img");
            plusImg.src = 'src/images/plus_icon.png';
            plusImg.className = 'plus-img';
            plusDiv.appendChild(plusImg);
            plusAreaDiv.appendChild(plusDiv);

            const plusText = document.createElement("div");
            plusText.className = 'plus-text-div';
            plusText.innerText='등록하러 가기';
            plusAreaDiv.appendChild(plusText);

            plusAreaDiv.addEventListener('click', () =>
                window.location.href = "sigungu.html"
            );

            div.appendChild(plusAreaDiv);

            noData.appendChild(div);
            timeLineContainer.appendChild(noData);
        }
    });
</script>
</body>
</html>
